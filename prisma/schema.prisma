generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model DesignerFinanceiro {
  designer_id         Int       @id
  senha_hash          String?
  reset_token         String?   @unique
  reset_token_expires DateTime?
  saldo_disponivel    Decimal   @default(0.00) @db.Decimal(10, 2)
  saldo_pendente      Decimal   @default(0.00) @db.Decimal(10, 2)
  ultimo_saque_em     DateTime?
  criado_em           DateTime  @default(now())
  atualizado_em       DateTime  @updatedAt
  chave_pix           String?
  pontuacao           Int       @default(0)

  @@map("designers_financeiro")
}

model Empresa {
  id                           Int      @id @default(autoincrement())
  bitrix_company_id            Int?     @unique
  cnpj                         String   @unique @db.VarChar(18)
  nome_fantasia                String   @db.VarChar(255)
  logo                         String?  @db.Text
  whatsapp                     String?  @db.VarChar(20)
  criado_em                    DateTime @default(now()) @db.Timestamptz(6)
  atualizado_em                DateTime @updatedAt @db.Timestamptz(6)
  
  // Saldos
  saldo_devedor                Decimal  @default(0.00) @db.Decimal(10, 2)
  aprovados                    Decimal  @default(0.00) @db.Decimal(10, 2)

  // Novos campos para a Carteira
  credito_aprovado             Boolean  @default(false)
  solicitacao_credito_pendente Boolean  @default(false)

  historico_financeiro         HistoricoFinanceiro[]

  @@map("empresas")
}

model HistoricoFinanceiro {
  id          Int      @id @default(autoincrement())
  empresa_id  Int
  valor       Decimal  @db.Decimal(10, 2)
  deal_id     String?
  titulo      String?
  data        DateTime @default(now())

  empresa     Empresa  @relation(fields: [empresa_id], references: [id])

  @@map("historico_financeiro")
}